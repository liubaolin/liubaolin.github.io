<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />




  


  <link rel="alternate" href="/atom.xml" title="Richey's Blog" type="application/atom+xml" />






<meta name="description" content="花有重开时人无再少年">
<meta property="og:type" content="website">
<meta property="og:title" content="Richey&#39;s Blog">
<meta property="og:url" content="http://10000hours.top/page/5/index.html">
<meta property="og:site_name" content="Richey&#39;s Blog">
<meta property="og:description" content="花有重开时人无再少年">
<meta property="article:author" content="Richey Liu">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://10000hours.top/page/5/"/>





  <title>Richey's Blog</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Richey's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">面朝大海，春暖花开</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/25/Spring%20MVC%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/25/Spring%20MVC%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B/" itemprop="url">Spring MVC请求处理流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-25T00:00:00+08:00">
                2019-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/25/Spring%20MVC%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/25/Spring%20MVC%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/25/Spring%20MVC%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B/" class="leancloud_visitors" data-flag-title="Spring MVC请求处理流程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring请求处理流程图："><a href="#Spring请求处理流程图：" class="headerlink" title="Spring请求处理流程图："></a>Spring请求处理流程图：</h1><p><img src="http://blog-pic-1254088127.picsh.myqcloud.com/SpringMvc%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.jpg" alt="Spring请求处理流程"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/20/Spring%20MVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/20/Spring%20MVC/" itemprop="url">Spring MVC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-20T00:00:00+08:00">
                2019-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/20/Spring%20MVC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/20/Spring%20MVC/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/20/Spring%20MVC/" class="leancloud_visitors" data-flag-title="Spring MVC">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、Spring-MVC-Quick-Start"><a href="#一、Spring-MVC-Quick-Start" class="headerlink" title="一、Spring MVC Quick Start"></a>一、Spring MVC Quick Start</h1><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><h3 id="Spring-MVC最简单的配置"><a href="#Spring-MVC最简单的配置" class="headerlink" title="Spring MVC最简单的配置"></a>Spring MVC最简单的配置</h3><ol>
<li><p>在web.xml中配置Servlet</p>
<p> Spring MVC的本质就是一个Servlet</p>
<pre><code>&lt;!-- spring mvc 配置开始 --&gt;
&lt;!-- Spring MVC本质上就是一个Servlet --&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;!--  contextConfigLocation参数来指定Spring MVC配置文件的位置，默认为WEB-INF/[Servlet-Name]-servlet.xml文件  --&gt;
    &lt;!--  &lt;init-param&gt;
          &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
          &lt;param-value&gt;&lt;/param-value&gt;
      &lt;/init-param&gt;--&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;!-- spring mvc 配置结束 --&gt;</code></pre></li>
<li><p>创建Spring MVC的xml配置文件</p>
 <!--
         mvc:annotation-driven是 Spring MVC提供的一键式配置方法
         配置此标签后Spring MVC会帮我们自动做一些注册组件之类的事情
     -->
<pre><code>&lt;mvc:annotation-driven/&gt;
&lt;!--扫描通过注解配置的类--&gt;
&lt;context:component-scan base-package=&quot;top.richpeople&quot;&gt;
    &lt;!--如果使用了spring,可以用context:include-filter设置只扫描@Controller别的交给Spring容器去管理--&gt;
    &lt;!--&lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;--&gt;
&lt;/context:component-scan&gt;</code></pre></li>
<li><p>创建Controller和view</p>
<pre><code>/**
 * 处理HEAD类型的&quot;/&quot;请求
 * 此方法可以用来检测服务器的状态,因为它不返回body,所以笔GET请求更节省网络资源
 * @return
 */
@RequestMapping(value = &quot;/&quot;, method = RequestMethod.HEAD)
public String head() {
    return &quot;go.jsp&quot;;
}

/**
 * 处理GET类型的&quot;/index&quot;和&quot;/&quot;请求
 */
@RequestMapping(value = {&quot;/index&quot;, &quot;/&quot;}, method = RequestMethod.GET)
public String testMapPathUri(Model model) {

    model.addAttribute(&quot;msg&quot;, &quot;Go Go Go!&quot;);
    return &quot;go.jsp&quot;;
}</code></pre><p> 如果没有配置ViewResolver，Spring MVC将默认使用org.springframework.web.servlet.view.InternalResourcViewResolver作为ViewResolver，而且prefix和suffix都为空</p>
</li>
</ol>
<h1 id="二、Spring-MVC-架构分析"><a href="#二、Spring-MVC-架构分析" class="headerlink" title="二、Spring MVC 架构分析"></a>二、Spring MVC 架构分析</h1><p><img src="http://ogiythg18.bkt.clouddn.com/DispatcherServlet.png" alt="DispatcherServlet"></p>
<p>XXXAware在Spring中表示对XXX可感知，通俗点讲就是：如果在某个类里想用Spring的某个东西，就实现相应的XXXAware接口，Spring看到后就会给你送过来。</p>
<h3 id="Spring中3个类的具体创建过程"><a href="#Spring中3个类的具体创建过程" class="headerlink" title="Spring中3个类的具体创建过程"></a>Spring中3个类的具体创建过程</h3><p>//TODO  这里要撸源码进行分析</p>
<ul>
<li><p>HttpServletBean</p>
<p>  没有参与实际请求的处理</p>
</li>
<li><p>FrameworkServlet</p>
<p>  将不同的请求合并到了processRequest方法统一处理，processRequest方法中做了三件事：</p>
<ul>
<li>调用了doService模板方法具体处理请求</li>
<li>将当请求的LocaleContext和ServletRequestAttributes在处理请求前设置到了LocaleContextHolder和RequestContextHolder,并在请求处理完后恢复。</li>
<li>请求完后发布了ServletRequestHandledEvent消息</li>
</ul>
</li>
<li><p>DispatcherServlet</p>
<p>  doService方法给request设置了一些属性并将请求交给doDispatch方法具体处理</p>
</li>
</ul>
<h1 id="三、Spring-MVC组件分析"><a href="#三、Spring-MVC组件分析" class="headerlink" title="三、Spring MVC组件分析"></a>三、Spring MVC组件分析</h1><p>这里的组件指的是DispatcherServlet中直接初始化的那九个组件，不同的组件内部可能还会用到一些子组件。</p>
<h3 id="1、-HandlerMapping"><a href="#1、-HandlerMapping" class="headerlink" title="1、 HandlerMapping"></a>1、 HandlerMapping</h3><p>它的作用是根据request找到相应的处理器Handler和Interceptors，该接口只有一个方法：</p>
<pre><code>HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception;</code></pre><p>HandlerMapping编写出来后要注册到Spring MVC的容器里面才可以使用，注册和那简单，只需要在配置文件里配置一个Bean就可以了（或者使用注解）。</p>
<p>如果有多个HandlerMapping匹配到了同一个处理器Hander，这时就要设置HandlerMapping的顺序。HandlerMapping的顺序通过实现Order接口设置order属性来定义。</p>
<p>查找Handler是按顺序遍历所有的HandlerMapping，当找到一个HandlerMapping后立即停止并返回。</p>
<h3 id="2、HandlerAdapter"><a href="#2、HandlerAdapter" class="headerlink" title="2、HandlerAdapter"></a>2、HandlerAdapter</h3><p>可以理解为使用处理器Handler干活的人</p>
<p>为什么使用handlerAdapter?</p>
<pre><code>Spring MVC没有对处理器Handler做任何的限制，处理器可以是任何合理的方式，可以是类、方法或者别的合理的方式，所以我们要用不用的Adapter去使用这些Handler</code></pre><p>我们自定义Adapter只需要实现HandlerAdapter，完成相应的逻辑就可以了，同样可以实现Order接口，默认使用第一个按顺序找到的Adapter。HandlerAdapter同样需要注册到Spring MVC容器中，只需要配置一个Bean就可以了。</p>
<h3 id="3、HandlerExceptionResolver"><a href="#3、HandlerExceptionResolver" class="headerlink" title="3、HandlerExceptionResolver"></a>3、HandlerExceptionResolver</h3><p>此组件的作用是根据异常设置ModelAndView，之后再交给render方法去渲染。</p>
<h3 id="4、ViewResolver"><a href="#4、ViewResolver" class="headerlink" title="4、ViewResolver"></a>4、ViewResolver</h3><p>用来将String类型的视图名（有地方也叫逻辑视图，都是同一个东西）和Locale解析为View类型的视图。</p>
<p>一般情况下我们只需要根据视图名找到视图，然后进行渲染，并不需要对不同的区域使用不同的视图。</p>
<p>View是用来渲染页面的，通俗点将就是将程序返回的参数填入到模板里，生成html（或者是其它类型）的文件。这里有两个关键的问题：</p>
<ul>
<li>使用什么模板</li>
<li>用什么技术或规则填入参数</li>
</ul>
<p>这起是就是ViewResolver要做的工作。</p>
<pre><code>View resolveViewName(String viewName, Locale locale) throws Exception;</code></pre><ul>
<li><p>UrlBasedViewResolver系列解析器都是针对单一视图类型进行解析的</p>
<ul>
<li>InternalResourceViewResolver 只解析jsp类型的视图</li>
<li>FreeMarkerViewResolver只针对FreeMarker</li>
<li>VelocityViewResolver只针对Velocity</li>
</ul>
</li>
<li><p>ResourceBundleViewResolver、XmlViewResolver、BeanNameViewResolver等解析器可以同时解析多种类型的视图。</p>
</li>
</ul>
<p>ViewResolver的使用需要注册到Spring MVC容器里，默认使用的是org.springframework.web.servlet.view.InternalResourceViewResolver。</p>
<h3 id="5、RequestToViewNameTranslator"><a href="#5、RequestToViewNameTranslator" class="headerlink" title="5、RequestToViewNameTranslator"></a>5、RequestToViewNameTranslator</h3><p>ViewResolver是根据viewName查找View，但是有的Handler处理完后没有这只View也没有设置viewName，这时需要从request中获取viewName，而如何从request中获取viewName就是RequestToViewNameTranslator要做的事情。</p>
<pre><code>String getViewName(HttpServletRequest request) throws Exception;</code></pre><p>具体的处理逻辑需要我们自己实现，要注意的是RequestToViewNameTranslator在Spring MVC容器中只能配置一个，所有的request到viewName的转换都要在一个Rranslator中实现。</p>
<h3 id="6、LocaleResolver"><a href="#6、LocaleResolver" class="headerlink" title="6、LocaleResolver"></a>6、LocaleResolver</h3><p>视图的解析需要两个参数，一个是视图名，一个是Locale，视图名是从Handler返回的（或者是使用RequestToViewNameTranslator解析的默认视图名），而Locale是LocaleResolver从request中解析出来的。</p>
<pre><code>Locale resolveLocale(HttpServletRequest request);

void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale);</code></pre><p>org.springframework.web.servlet.i18n.LocaleChangeInterceptor拦截器为我么那提供了默认修改Locale的便捷方式。</p>
<h3 id="7、ThemeResolver"><a href="#7、ThemeResolver" class="headerlink" title="7、ThemeResolver"></a>7、ThemeResolver</h3><h3 id="8、MultipartResolver"><a href="#8、MultipartResolver" class="headerlink" title="8、MultipartResolver"></a>8、MultipartResolver</h3><p>MultipartResolver用于处理上传请求，处理方法就是将普通的request包装成HttpServletRequest，后者可以直接调用getFile方法获取到File，如果上传多个文件，还可以调用getFileMap得到fileName-File结构的Map。</p>
<p>其实如果上传请求不用MutipartResolver封装成HttpServletRequest，直接用原来的request也是可以的，所以Spring MVC中没有为此组件提供默认值。</p>
<h3 id="9、FlashMapManager"><a href="#9、FlashMapManager" class="headerlink" title="9、FlashMapManager"></a>9、FlashMapManager</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/18/Spring%20Boot(7)-Spring%20Boot%20%E4%B8%A4%E7%A7%8D%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%EF%BC%9AJdbcTemplate%E3%80%81Spring-data-jpa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/18/Spring%20Boot(7)-Spring%20Boot%20%E4%B8%A4%E7%A7%8D%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%EF%BC%9AJdbcTemplate%E3%80%81Spring-data-jpa/" itemprop="url">Spring Boot(7)-Spring Boot 两种多数据源配置：JdbcTemplate、Spring-data-jpa</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-18T00:00:00+08:00">
                2019-05-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/18/Spring%20Boot(7)-Spring%20Boot%20%E4%B8%A4%E7%A7%8D%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%EF%BC%9AJdbcTemplate%E3%80%81Spring-data-jpa/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/18/Spring%20Boot(7)-Spring%20Boot%20%E4%B8%A4%E7%A7%8D%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%EF%BC%9AJdbcTemplate%E3%80%81Spring-data-jpa/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/18/Spring%20Boot(7)-Spring%20Boot%20%E4%B8%A4%E7%A7%8D%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%EF%BC%9AJdbcTemplate%E3%80%81Spring-data-jpa/" class="leancloud_visitors" data-flag-title="Spring Boot(7)-Spring Boot 两种多数据源配置：JdbcTemplate、Spring-data-jpa">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在单数据源的情况下，spring Boot的数据源配置非常简单，只要在applicatrion.properties中配置连接参数即可。但是随着业务的发展我们常常会对数据库拆分或者引入其它的数据库，从而需要配置多个数据源。下面我们就基于JdbcTemplate和Spring-data-jap介绍配置多数据源的方式。</p>
<h2 id="多数据源配置"><a href="#多数据源配置" class="headerlink" title="多数据源配置"></a>多数据源配置</h2><p>创建一个Spring配置类，定义两个DataSource用来读取application.properties中的不同配置。如下例子中，主数据源配置为spring.datasource.primary开头的配置，第二数据源配置为spring.datasource.secondary开头的配置。</p>
<pre><code>/**
 * 多数据源配置
 */
@Configuration
public class DataSourceConfig {

    @Bean(name = &quot;primaryDataSource&quot;)
    @Primary
    @ConfigurationProperties(prefix=&quot;spring.datasource.primary&quot;)
    public DataSource primaryDataSource() {
        return DataSourceBuilder.create().build();
    }

    @Bean(name = &quot;secondaryDataSource&quot;)
    @ConfigurationProperties(prefix=&quot;spring.datasource.secondary&quot;)
    public DataSource secondaryDataSource() {
        return DataSourceBuilder.create().build();
    }


}</code></pre><p>对应application.properties中的配置如下：</p>
<pre><code># 多数据源配置
spring.datasource.primary.url=jdbc:mysql://localhost:3306/spring-boot-db1?useUnicode=true&amp;characterEncoding=utf8
spring.datasource.primary.username=root
spring.datasource.primary.password=root
spring.datasource.primary.driver-class-name=com.mysql.jdbc.Driver

spring.datasource.secondary.url=jdbc:mysql://localhost:3306/spring-boot-db2?useUnicode=true&amp;characterEncoding=utf8
spring.datasource.secondary.username=root
spring.datasource.secondary.password=root
spring.datasource.secondary.driver-class-name=com.mysql.jdbc.Driver</code></pre><h2 id="JdbcTemplate配置多数据源"><a href="#JdbcTemplate配置多数据源" class="headerlink" title="JdbcTemplate配置多数据源"></a>JdbcTemplate配置多数据源</h2><p>为JdbcTemplate配置多数据源比较简单，只要为其注入不同的Datasource即可，如下：</p>
<pre><code>/**
 * JdbcTemplate支持多数据源
 */
@Configuration
public class JdbcTemplateConfig {

    @Bean(name = &quot;primaryJdbcTemplate&quot;)
    public JdbcTemplate primaryJdbcTemplate(
            @Qualifier(&quot;primaryDataSource&quot;) DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }

    @Bean(name = &quot;secondaryJdbcTemplate&quot;)
    public JdbcTemplate secondaryJdbcTemplate(
            @Qualifier(&quot;secondaryDataSource&quot;) DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }

}</code></pre><h2 id="测试JdbcTemplate多数据源"><a href="#测试JdbcTemplate多数据源" class="headerlink" title="测试JdbcTemplate多数据源"></a>测试JdbcTemplate多数据源</h2><pre><code>@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringBootDemoApplication.class)
public class MultipleDatasource4JdbcTemplateTest {

    @Autowired
    @Qualifier(&quot;primaryJdbcTemplate&quot;)
    protected JdbcTemplate jdbcTemplate1;

    @Autowired
    @Qualifier(&quot;secondaryJdbcTemplate&quot;)
    protected JdbcTemplate jdbcTemplate2;

    @Before
    public void setUp() {
        jdbcTemplate1.update(&quot;delete from user &quot;);
        jdbcTemplate2.update(&quot;delete from user &quot;);
    }


    @Test
    public void test() throws Exception {

        // 往第一个数据源中插入两条数据
        jdbcTemplate1.update(&quot;insert into user(id,name,age) values(?, ?, ?)&quot;, 1, &quot;aaa&quot;, 20);
        jdbcTemplate1.update(&quot;insert into user(id,name,age) values(?, ?, ?)&quot;, 2, &quot;bbb&quot;, 30);

        // 往第二个数据源中插入一条数据，若插入的是第一个数据源，则会主键冲突报错
        jdbcTemplate2.update(&quot;insert into user(id,name,age) values(?, ?, ?)&quot;, 1, &quot;aaa&quot;, 20);

        // 查一下第一个数据源中是否有两条数据，验证插入是否成功
        Assert.assertEquals(&quot;2&quot;, jdbcTemplate1.queryForObject(&quot;select count(1) from user&quot;, String.class));

        // 查一下第一个数据源中是否有两条数据，验证插入是否成功
        Assert.assertEquals(&quot;1&quot;, jdbcTemplate2.queryForObject(&quot;select count(1) from user&quot;, String.class));

    }

}</code></pre><h2 id="Spring-data-jpa配置多数据源"><a href="#Spring-data-jpa配置多数据源" class="headerlink" title="Spring-data-jpa配置多数据源"></a>Spring-data-jpa配置多数据源</h2><p>对于数据源的配置可以沿用上例中DataSourceConfig的实现。</p>
<p>配置Spring-data-jpa多数据源时要注意，需要指定数据源对应的Entity实体和Repository定义位置。用@Primary区分主数据源。</p>
<p>配置第一数据源：</p>
<pre><code>@Configuration
@EnableTransactionManagement
@EnableJpaRepositories(entityManagerFactoryRef = &quot;entityManagerFactoryPrimary&quot;,
        transactionManagerRef=&quot;transactionManagerPrimary&quot;,
        basePackages=&quot;top.evolutionary.springbootdemo.repository.primary&quot;//设置Repository所在位置
)
public class SpringDataJpaPrimaryConfig {

    @Autowired
    @Qualifier(&quot;primaryDataSource&quot;)
    private DataSource primaryDataSource;

    @Primary
    @Bean(name = &quot;entityManagerPrimary&quot;)
    public EntityManager entityManager(EntityManagerFactoryBuilder builder) {
        return entityManagerFactoryPrimary(builder).getObject().createEntityManager();
    }


    @Primary
    @Bean(name = &quot;entityManagerFactoryPrimary&quot;)
    public LocalContainerEntityManagerFactoryBean entityManagerFactoryPrimary (EntityManagerFactoryBuilder builder) {
        return builder
                .dataSource(primaryDataSource)
                .properties(getVendorProperties(primaryDataSource))
                .packages(&quot;top.evolutionary.springbootdemo.dto.primary&quot;) //设置实体类所在位置
                .persistenceUnit(&quot;primaryPersistenceUnit&quot;)
                .build();
    }


    @Autowired
    private JpaProperties jpaProperties;

    private Map&lt;String, String&gt; getVendorProperties(DataSource dataSource) {
        return jpaProperties.getHibernateProperties(dataSource);
    }

    @Primary
    @Bean(name = &quot;transactionManagerPrimary&quot;)
    public PlatformTransactionManager transactionManagerPrimary(EntityManagerFactoryBuilder builder) {
        return new JpaTransactionManager(entityManagerFactoryPrimary(builder).getObject());
    }

}</code></pre><p>配置第二数据源：</p>
<p>@Configuration<br>@EnableTransactionManagement<br>@EnableJpaRepositories(entityManagerFactoryRef = “entityManagerFactorySecondary”,<br>        transactionManagerRef=”transactionManagerSecondary”,<br>        basePackages=”top.evolutionary.springbootdemo.repository.secdary”//设置Repository所在位置<br>)<br>public class SpringDataJpaSecdaryConfig {</p>
<pre><code>@Autowired
@Qualifier(&quot;secondaryDataSource&quot;)
private DataSource primaryDataSource;

@Bean(name = &quot;entityManagerSecondary&quot;)
public EntityManager entityManager(EntityManagerFactoryBuilder builder) {
    return entityManagerFactoryPrimary(builder).getObject().createEntityManager();
}


@Bean(name = &quot;entityManagerFactorySecondary&quot;)
public LocalContainerEntityManagerFactoryBean entityManagerFactoryPrimary (EntityManagerFactoryBuilder builder) {
    return builder
            .dataSource(primaryDataSource)
            .properties(getVendorProperties(primaryDataSource))
            .packages(&quot;top.evolutionary.springbootdemo.dto.secdary&quot;) //设置实体类所在位置
            .persistenceUnit(&quot;secondaryPersistenceUnit&quot;)
            .build();
}


@Autowired
private JpaProperties jpaProperties;

private Map&lt;String, String&gt; getVendorProperties(DataSource dataSource) {
    return jpaProperties.getHibernateProperties(dataSource);
}

@Bean(name = &quot;transactionManagerSecondary&quot;)
public PlatformTransactionManager transactionManagerPrimary(EntityManagerFactoryBuilder builder) {
    return new JpaTransactionManager(entityManagerFactoryPrimary(builder).getObject());
}</code></pre><p>}</p>
<h2 id="测试Spring-data-jpa多数据源"><a href="#测试Spring-data-jpa多数据源" class="headerlink" title="测试Spring-data-jpa多数据源"></a>测试Spring-data-jpa多数据源</h2><pre><code>@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringBootDemoApplication.class)
public class MultipleDatasource4JpaTest {

    @Autowired
    private StaffRepository staffRepository;
    @Autowired
    private CompanyRepository companyRepository;

    @Before
    public void delete() {
        staffRepository.deleteAll();
        companyRepository.deleteAll();
    }


    @Test
    public void test() throws Exception{
        staffRepository.save(new Staff(&quot;richey1&quot;,18));
        staffRepository.save(new Staff(&quot;richey2&quot;,19));
        staffRepository.save(new Staff(&quot;richey3&quot;,20));

        Assert.assertEquals(3, staffRepository.findAll().size());

        companyRepository.save(new Company(&quot;company1&quot;, &quot;add1&quot;));
        companyRepository.save(new Company(&quot;company2&quot;, &quot;add2&quot;));

        Assert.assertEquals(2, companyRepository.findAll().size());


    }

}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/16/Spring%20Boot(6)-%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/16/Spring%20Boot(6)-%E6%B5%8B%E8%AF%95/" itemprop="url">Spring Boot(6)-测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-16T00:00:00+08:00">
                2019-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/16/Spring%20Boot(6)-%E6%B5%8B%E8%AF%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/16/Spring%20Boot(6)-%E6%B5%8B%E8%AF%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/16/Spring%20Boot(6)-%E6%B5%8B%E8%AF%95/" class="leancloud_visitors" data-flag-title="Spring Boot(6)-测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.spring4all.com/article/252" target="_blank" rel="noopener">本文转自http://www.spring4all.com/article/252</a></p>
<h3 id="集成测试自动配置"><a href="#集成测试自动配置" class="headerlink" title="集成测试自动配置"></a>集成测试自动配置</h3><ul>
<li><p>@SpringJUini4ClassRunner</p>
<p>  开启了Spring集成测试的支持。<br>  自Spring 2.5开始，集成测试支持的形式就变成了SpringJUini4ClassRunner。这是一个Junit测试类运行器，会为Junit测试加载Spring上下文，并为测试类自动织入所需要的Bean。</p>
</li>
<li><p>SpringRunner</p>
<p>  SpringRunner继承了SpringJUini4ClassRunner，但是没有扩展任何的接口，只是名字简短了，所以它跟SpringJUini4ClassRunner左右是一样的，没有区别。</p>
</li>
<li><p>@ContextConfiguration</p>
<p>  指定了如何加载应用上下文。</p>
</li>
<li><p>@SpringApplicationConfiguration</p>
<p>  不仅加载应用上下文，还会开启日志/加载外部属性(application.properties等)以及其它的Spring Boot特性。大多数情况下，我们会用@SpringApplicationConfiguration代替@ContextConfiguration。</p>
</li>
</ul>
<ul>
<li><p>@SpringBootTest</p>
<p>  不仅加载应用上下文，还会开启日志/加载外部属性(application.properties等)以及其它的Spring Boot特性。较新版本的Spring Boot取消了@SpringApplicationConfiguration，改用@SpringBootTest就可以了.</p>
</li>
</ul>
<pre><code>@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringBootDemoApplication.class)
public class HelloWorldTest {

    @Autowired
    private HelloWorldService helloWorldService;

    @Test
    public void testSayHello() {
        Assert.assertEquals(helloWorldService.sayHello(), &quot;Hello World!&quot;);
    }

}</code></pre><h3 id="测试Web应用程序"><a href="#测试Web应用程序" class="headerlink" title="测试Web应用程序"></a>测试Web应用程序</h3><p>要恰当的测试Web应用程序，需要使用一些真实的HTTP请求，测试我们的程序可以正确的处理这些请求。Spring Boot为我们提供了两种方案来实现这类测试。</p>
<ul>
<li><p>Spring Mock MVC</p>
<p>  能在一个近似真实的模拟Servlet容器里测试控制器，而不用实际启动应用服务器。</p>
</li>
<li><p>Web集成测试</p>
<p>  在嵌入式Servlet容器里（如Tomcat、Jetty）启动应用程序，在真实的应用服务器里执行测试。</p>
</li>
</ul>
<h4 id="Spring-Mock-MVC"><a href="#Spring-Mock-MVC" class="headerlink" title="Spring Mock MVC"></a>Spring Mock MVC</h4><p>要在测试里使用Mock MVC，可以使用MockMVCbuilders,该类提供了两个静态方法：</p>
<ul>
<li><p>standaloneSetup（）</p>
<p>  构建一个Mock MVC，提供一个或多个手工创建并配置的控制器。</p>
</li>
<li><p>webAppContextSetup（）</p>
<p>  使用Spring应用上下文（WebApplicationcontext）来构建MVC，上下文里可以包含一个或多个配置号的控制器。</p>
</li>
</ul>
<p>两者的区别是，standaloneSetup（）希望我们手工初始化并注入我们测试的控制器，而webAppContextSetup（）基于一个WebApplicationContext的实例，由Spring加载。前者可能只想让它专注于单一控制器的测试，而后者让Spring加载控制器及依赖。</p>
<pre><code>@RunWith(SpringRunner.class)
@SpringBootTest(classes = DemoApplication.class)
public class UserControllerTest {

    @Autowired
    private WebApplicationContext applicationContext;

    private MockMvc mockMvc;

    @Before
    public void setUp() {
        mockMvc = MockMvcBuilders.webAppContextSetup(applicationContext).build();
    }

    @Test
    public void whenQuerySuccess() throws Exception {
        String result = mockMvc.perform(get(&quot;/user&quot;)
                .param(&quot;username&quot;, &quot;richey&quot;)
                .param(&quot;age&quot;, &quot;18&quot;)
                .contentType(MediaType.APPLICATION_JSON_UTF8))
                .andExpect(status().isOk())
                .andExpect(jsonPath(&quot;$.length()&quot;).value(3))
                .andReturn().getResponse().getContentAsString();
        System.out.println(result);
    }



    @Test
    public void whenCreateSuccess() throws Exception {
        Date date = new Date();
        System.out.println(date.getTime());
        String content = &quot;{\&quot;id\&quot;:null,\&quot;userName\&quot;:\&quot;richey\&quot;,\&quot;password\&quot;:null,\&quot;birthday\&quot;:&quot; + date.getTime() + &quot;}&quot;;
        String result = mockMvc.perform(post(&quot;/user&quot;).contentType(MediaType.APPLICATION_JSON_UTF8).content(content))
                .andExpect(status().isOk())
                .andExpect(jsonPath(&quot;$.id&quot;).value(&quot;1&quot;))
                .andReturn().getResponse().getContentAsString();
        System.out.println(result);
    }



}</code></pre><h4 id="测试Web安全"><a href="#测试Web安全" class="headerlink" title="测试Web安全"></a>测试Web安全</h4><p>应用程序里使用了Spring Security的测试模块后，需要创建MockMVC实例运行时的Spring Security配置器。</p>
<p>//TODO</p>
<h4 id="测试运行中的应用程序"><a href="#测试运行中的应用程序" class="headerlink" title="测试运行中的应用程序"></a>测试运行中的应用程序</h4><p>Spring Boot支持Tomcat或Jetty这样的嵌入式Servlet容器作为运行中应用程序的一部分，而且可以用相同的机制在测试的过程中用嵌入式Servlet容器来启动应用程序。</p>
<ul>
<li><p>@WebIntegrationTest</p>
<p>  启动一个嵌入式的Servlet容器，默认是8080端口。一旦应用程序运行在嵌入式容器中，就可以发真实的HTTP请求（比如使用RestTemplate），断言结果了。</p>
</li>
<li><p>使用随机端口启动服务器</p>
<p>  将server.port属性设置为0，让Spring Boot选一个随机的端口。@WebIntegrationTest的value属性支持一个String数组，数组中的每项都是键值对，形如name=value用来设置测试中使用的属性，如：</p>
<pre><code>@WebIntegrationTest(value={&quot;server.port=0&quot;})</code></pre><p>  @WebIntegrationTest还提供了一个randomPort属性，更明确的表示让服务器在随机的端口上启动。</p>
<p>  Spring Boot将local.server.port值设置为了选中的端口，所以我们使用的时候将该属性注入即可：</p>
<pre><code>@Value(&quot;$local.server.port&quot;)
private int port;</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/15/Spring%20Boot(%EF%BC%95)-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/15/Spring%20Boot(%EF%BC%95)-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/" itemprop="url">Spring Boot(５)-常用属性配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-15T00:00:00+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/15/Spring%20Boot(%EF%BC%95)-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/15/Spring%20Boot(%EF%BC%95)-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/15/Spring%20Boot(%EF%BC%95)-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/" class="leancloud_visitors" data-flag-title="Spring Boot(５)-常用属性配置">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h3><p>默认Spring Boot会用Logback来记录日志，并用INFO级别输出到控制台。</p>
<h5 id="使用其它日志实现替换Logback"><a href="#使用其它日志实现替换Logback" class="headerlink" title="使用其它日志实现替换Logback"></a>使用其它日志实现替换Logback</h5><p>一般来说我们不需要切换日志实现，但是如果我们决定使用Log4j或Log4j2，那么只需要修改依赖，引入相应日志的起步依赖，同时排除掉Logback。</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-log4j&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><h5 id="logback-xml"><a href="#logback-xml" class="headerlink" title="logback.xml"></a>logback.xml</h5><p>要完全掌握日志配置可以在Classpath的根目录(src/min/resources)里创建logback.xml文件。具体配置可以参考Logback文档。</p>
<p>除了日志格式外，加lockback.xml配置和不加该配置文件的默认配置差不多。</p>
<p>实际上，我们对日配置最常做的改动就是修改日志级别和指定日志输出文件，使用了Spring Boot的配置属性后，我们可以在不创建logback文件的情况下修改这些配置：</p>
<pre><code>logging.level.root=warn
logging.level.top.evolutionary=debug
logging.path=/var/logs
logging.file=evolutionary.log
# 默认情况下，日志文件的大小达到１０Ｍ会切分一次
logging.file.max-size=20M</code></pre><h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><p>只需要通过属性配置数据库的URL和身份信息等就可以了。</p>
<pre><code># 数据源
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/evolutionary_security?useUnicode=true&amp;characterEncoding=utf8
spring.datasource.username=root
spring.datasource.password=root</code></pre><p>在自动配置DataSource Bean的时候，Spring Boot 会使用这里的连接数据。DataSource Bean是一个连接池，如果Classpath里有Tomcat的连接池DataSource，那么会使用这个连接池，否则Spring Boot会在Classpath下找以下连接池:</p>
<ul>
<li>HikariCP</li>
<li>Commons DBCP</li>
<li>Commons DBCP2</li>
</ul>
<p>这里列出的只是自动配置支持的连接池，我们还可以自己配DataSource Bean,用我们喜欢的各种连接池。</p>
<pre><code># 从jndi里查找DataSource
#spring.datasource.jndi-name=</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/14/Spring%20Boot(4)-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/14/Spring%20Boot(4)-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/" itemprop="url">Spring Boot(4)-属性配置介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-14T00:00:00+08:00">
                2019-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/14/Spring%20Boot(4)-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/14/Spring%20Boot(4)-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/14/Spring%20Boot(4)-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/" class="leancloud_visitors" data-flag-title="Spring Boot(4)-属性配置介绍">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、自动配置"><a href="#一、自动配置" class="headerlink" title="一、自动配置"></a>一、自动配置</h3><p>在使用Spring Boot之前，我们自己整合Spring应用时需要进行繁琐的xml配置，Spring Boot通过起步依赖和自动配置，使我们只需要引入起步依赖的相关模块就可以了，其中各个模块有自己的默认配置，我们只要在application.properties中完成一些属性的配置就可以了。比如数据库连接、日志相关配置等。</p>
<p>Spring Boot 不单单从 application.properties获取配置，所以我们可以在程序中多种设置配置属性。按照以下列表的优先级排列：</p>
<ol>
<li>命令行参数</li>
<li>java:comp/env 里的 JNDI 属性</li>
<li>JVM 系统属性</li>
<li>操作系统环境变量</li>
<li>RandomValuePropertySource 属性类生成的 random.* 属性</li>
<li>应用以外的 application.properties（或 yml）文件</li>
<li>打包在应用内的 application.properties（或 yml）文件</li>
<li>在应用 @Configuration 配置类中，用 @PropertySource 注解声明的属性文件</li>
<li>SpringApplication.setDefaultProperties 声明的默认属性</li>
</ol>
<h3 id="二、自定义属性"><a href="#二、自定义属性" class="headerlink" title="二、自定义属性"></a>二、自定义属性</h3><p>除了各个模块默认的配置，我们在程序开发的过程中可能还需要一些自定义的配置，本篇我们学习一下自定义配置。</p>
<h5 id="1-定义自己使用的属性"><a href="#1-定义自己使用的属性" class="headerlink" title="1. 定义自己使用的属性"></a>1. 定义自己使用的属性</h5><p>直接在application.properties文件中定义即可，比如</p>
<pre><code>top.richpeople.blog.author=&apos;richey&apos;
top.richpeople.blog.age=18</code></pre><p>然后在程序中通过@Value(“${top.richpeople.blog.author}”)注解来加载对应的配置属性</p>
<pre><code>@Component
public class MyProperties {

    @Value(&quot;${top.richpeople.blog.author}&quot;)
    private String name ;

    @Value(&quot;${top.richpeople.blog.age}&quot;)
    private int age;

}</code></pre><h5 id="2-参数间的引用"><a href="#2-参数间的引用" class="headerlink" title="2. 参数间的引用"></a>2. 参数间的引用</h5><pre><code>top.richpeople.blog.desc=${top.richpeople.blog.author}的年龄是${top.richpeople.blog.age}</code></pre><h5 id="3-使用随机数"><a href="#3-使用随机数" class="headerlink" title="3. 使用随机数"></a>3. 使用随机数</h5><p>Spring Boot的属性配置文件中可以通过${random}来产生int值、long值或者string字符串，来支持属性的随机值.</p>
<pre><code># 使用随机数
# 随机字符串
top.richpeople.blog.value=${random.value}
# 随机int
top.richpeople.blog.number=${random.int}
# 随机long
top.richpeople.blog.bignumber=${random.long}
# 20以内的随机数
top.richpeople.blog.limit10=${random.int(10)}
# 10-20的随机数
top.richpeople.blog.between=${random.int[10,20]}</code></pre><h5 id="4-命令行中设置属性值"><a href="#4-命令行中设置属性值" class="headerlink" title="4. 命令行中设置属性值"></a>4. 命令行中设置属性值</h5><p>例如：</p>
<pre><code>java -jar xxx.jar --server.port=8080</code></pre><p>在命令行中连续两个减号–就是对application.properties中的属性进行赋值的标识。</p>
<p>通过命令行修改属性值是不完全的，所以Spring Boot 提供了屏蔽命令号访问属性值的设置：</p>
<pre><code>SpringApplication.setAddCommandLineProperties(false)。</code></pre><h5 id="5-多环境配置"><a href="#5-多环境配置" class="headerlink" title="5. 多环境配置"></a>5. 多环境配置</h5><p>通常我们的程序会部署到不同的环境，比如：开发、测试、生产等。其中每个环境的数据库地址、服务器端口等等配置都可能会不同。对于多环境的配置，我们通常会配置多份不同环境的配置文件，再通过打包命令指定需要打包的内容之后进行区分打包。</p>
<p>Spring Boot多环境配置文件名需要满足application-{profile}.proferties的格式，其中{profile}对应环境的标识，比如：</p>
<ul>
<li>application-dev.properties:开发环境</li>
<li>application-test.properties:测试环境</li>
<li>application-prod.properties:生产环境</li>
</ul>
<p>至于哪个具体的配置文件会被加载，需要在application.properties文件中通过spring.profiles.active属性来设置，其值对应{profile}值，如：</p>
<pre><code>spring.profiles.active=test</code></pre><p>也可以在打包时通过设置-Dspring.profiles.active=prod 去指定相应的配置:</p>
<pre><code>mvn package
java -jar -Dspring.profiles.active=prod springboot-properties-0.0.1-SNAPSHOT.jar</code></pre><p>总结：</p>
<ul>
<li>application.properties中配置通用内容，并设置spring.profiles.active=dev，以开发环境为默认配置</li>
<li>application-{profile}.properties中配置各个环境不同的内容</li>
<li>通过命令行方式去激活不同环境的配置</li>
<li>常用样板配置在Spring Boot官方文档给出：<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html</a></li>
</ul>
<h3 id="三、自定义配置文件"><a href="#三、自定义配置文件" class="headerlink" title="三、自定义配置文件"></a>三、自定义配置文件</h3><p>如果想从我们自定义的配置文件中读配置怎么办呢？Spring Boot同样做了很好的支持。</p>
<p>例如我们新建了一个配置文件：evolutionary.properties</p>
<pre><code>top.evolutionary.blog.title=SpringBoot自定义配置



@Component
@PropertySource(&quot;classpath:evolutionary.properties&quot;)
@ConfigurationProperties(prefix = &quot;top&quot;)
public class EvolutionaryProperties {

    @Value(&quot;${top.evolutionary.blog.title}&quot;)
    private String title;

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }
}</code></pre><p>springboot1.5版本以下@ConfigurationProperties有两个属性locations（指定配置文件的所在位置），    prefix（指定配置文件中键名称的前缀）。但是1.5版本及以上的版本取消了locations属性，为了指定配置文件的位置，使用@PropertySource(value = “自定义配置文件路径”)指定文件所在位置。</p>
<hr>
<p>感谢资料</p>
<p><a href="http://www.spring4all.com/article/267" target="_blank" rel="noopener">http://www.spring4all.com/article/267</a></p>
<p>《Spring Boot实战》，丁雪峰译</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/12/Spring%20Boot(3)-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/12/Spring%20Boot(3)-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" itemprop="url">Spring Boot(3)-快速入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-12T00:00:00+08:00">
                2019-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/12/Spring%20Boot(3)-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/12/Spring%20Boot(3)-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/12/Spring%20Boot(3)-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="leancloud_visitors" data-flag-title="Spring Boot(3)-快速入门">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看一下上一篇我们通过Spring initializr快速构建的Spring Boot项目结构。</p>
<p><img src="http://ogiythg18.bkt.clouddn.com/spring-boot-project-structure.png" alt="image"></p>
<ul>
<li><p>application.properties:用于配置应用程序和Spring Boot的属性</p>
</li>
<li><p>SpringBootDemoApplication.java</p>
<p>起配置和启动引导的作用。首先，这时Spring的主要配置类。虽然Spring Boot的自动配置免除了很多Spring配置，但我们还是需要进行少量的配置以启动自动配置。</p>
<p>@SpringBootApplication用于开启组件扫描和自动配置，实际上是将三个有用的注解组合在了一起：</p>
<ul>
<li>Spring的@Configuration</li>
<li>Spring的@ConponentScan</li>
<li>Spring Boot的@EnableAutoConfiguration，就是这一行配置开启了Spring Boot自动配置的魔力。</li>
</ul>
</li>
</ul>
<ul>
<li>SpringApplication.run:负责启动引打敖应用程序，这里的main方法，让我们可以在命令行中把应用程序当成一个可执行的jar来运行。</li>
</ul>
<pre><code>@SpringBootApplication
public class SpringBootDemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringBootDemoApplication.class, args);
    }
}</code></pre><hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/11/Spring%20Boot(2)-Intellij%E4%BD%BF%E7%94%A8Spring%20Initializr%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/11/Spring%20Boot(2)-Intellij%E4%BD%BF%E7%94%A8Spring%20Initializr%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/" itemprop="url">Spring Boot(2)-Intellij使用Spring Initializr快速构建工程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-11T00:00:00+08:00">
                2019-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/11/Spring%20Boot(2)-Intellij%E4%BD%BF%E7%94%A8Spring%20Initializr%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/11/Spring%20Boot(2)-Intellij%E4%BD%BF%E7%94%A8Spring%20Initializr%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/11/Spring%20Boot(2)-Intellij%E4%BD%BF%E7%94%A8Spring%20Initializr%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/" class="leancloud_visitors" data-flag-title="Spring Boot(2)-Intellij使用Spring Initializr快速构建工程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用Intellij中的Spring-Initializr来快速构建"><a href="#使用Intellij中的Spring-Initializr来快速构建" class="headerlink" title="使用Intellij中的Spring Initializr来快速构建"></a>使用Intellij中的Spring Initializr来快速构建</h3><p>在Intellig中使用Spring Initialzr来构建Spring Boot项目非常简单，基本只需要一只点下一步就可以了。</p>
<ul>
<li>菜单栏中选择File=&gt;New=&gt;Project..。其中Initial Service Url指向的地址就是Spring官方提供的Spring Initializr工具地址。</li>
</ul>
<p><img src="http://ogiythg18.bkt.clouddn.com/intellig-spring-initializr1.png" alt="Initializr"></p>
<ul>
<li>Next,在这里我们可以编辑我们想要创建的工程信息。其中，Type可以改变我们要构建的工程类型，比如：Maven、Gradle；Language可以选择：Java、Groovy、Kotlin。</li>
</ul>
<p><img src="http://ogiythg18.bkt.clouddn.com/intellig-spring-boot2.png" alt="Initializr"></p>
<ul>
<li>Next，进入选择Spring Boot版本和依赖管理的窗口。在这里值的我们关注的是，它不仅包含了Spring Boot Starter POMs中的各个依赖，还包含了Spring Cloud的各种依赖。</li>
</ul>
<p><img src="http://ogiythg18.bkt.clouddn.com/intelliij-spring-initializr3.png" alt="Initializr"></p>
<ul>
<li>Next,最后是工程物理存储的一些细节，最后Finesh就完成工程的构建了。</li>
</ul>
<hr>
<p><a href="http://www.spring4all.com/article/247" target="_blank" rel="noopener">参考自Spring4all</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/10/Spring%20Boot(1)-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/10/Spring%20Boot(1)-%E7%AE%80%E4%BB%8B/" itemprop="url">Spring Boot(1)-简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-10T00:00:00+08:00">
                2019-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/10/Spring%20Boot(1)-%E7%AE%80%E4%BB%8B/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/10/Spring%20Boot(1)-%E7%AE%80%E4%BB%8B/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/10/Spring%20Boot(1)-%E7%AE%80%E4%BB%8B/" class="leancloud_visitors" data-flag-title="Spring Boot(1)-简介">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can “just run”…Most Spring Boot applications need very little Spring configuration.</p>
</blockquote>
<p>Spring Boot(英文中是“引导”的意思)，是用来简化Spring应用的搭建到开发的过程。应用开箱即用，只要通过 “just run”（可能是 java -jar 或 tomcat 或 maven插件run 或 shell脚本），就可以启动项目。二者，Spring Boot 只要很少的Spring配置文件（例如那些xml，property）。 因为“习惯优先于配置”的原则，使得Spring Boot在快速开发应用和微服务架构实践中得到广泛应用。   Javaer装好JDK环境和Maven工具就可以开始学习Boot了~</p>
<h3 id="Spring-Boot-概要"><a href="#Spring-Boot-概要" class="headerlink" title="Spring Boot 概要"></a>Spring Boot 概要</h3><ul>
<li><p>自动配置</p>
<p>  针对Spring应用程序常见的功能，Spring能自动提供相关配置</p>
</li>
<li><p>起步依赖</p>
<p>  告诉Spring Boot需要什么样的功能，他就能引入需要的库</p>
</li>
<li><p>命令行界面</p>
</li>
</ul>
<ul>
<li>Actuator</li>
</ul>
<h4 id="1-自动配置"><a href="#1-自动配置" class="headerlink" title="1. 自动配置"></a>1. 自动配置</h4><p>如果在Classpath里发现JdbcTemplate，那么Spring Boot就会自动配置一个JdbcTemplate的Bean，我们无需操心这种Bean的配置，Spring Boot会做好准备，随时都可以将其注入到我们的Bean中。</p>
<h4 id="2-起步依赖"><a href="#2-起步依赖" class="headerlink" title="2. 起步依赖"></a>2. 起步依赖</h4><p>起步依赖其实就是特殊的Maven依赖或Gradle依赖，利用了传递依赖解析，把常用的库聚合在一起，组成了几个为特定功能而定制的依赖。</p>
<p>我们无需关注这些库的版本，Spring Boot起步依赖引入的库版本都是经过测试的，它们之间不会出现不兼容的情况。</p>
<p>例：Spring Boot的web起步依赖</p>
<pre><code>org.springframework.boot:spring-boot-starter-web</code></pre><h4 id="3-命令行界面"><a href="#3-命令行界面" class="headerlink" title="3. 命令行界面"></a>3. 命令行界面</h4><p>不常用。</p>
<h4 id="4-Actuator"><a href="#4-Actuator" class="headerlink" title="4. Actuator"></a>4. Actuator</h4><p>Actuator提供了在运行使检测应用程序内部情况的能力。，包括以下细节：</p>
<ul>
<li>Spring应用程序里配置的Bean</li>
<li>Spring Boot的自动配置做的决策</li>
<li>应用程序里线程的当前状态</li>
<li>应用程序最近处理过的HTTP请求的追踪情况</li>
<li>各种和内存用量、垃圾回收、Web请求以及数据源用量相关的指标</li>
</ul>
<h3 id="Spring-Boot的几点说明"><a href="#Spring-Boot的几点说明" class="headerlink" title="Spring Boot的几点说明"></a>Spring Boot的几点说明</h3><h4 id="1-Spring-Boot不是应用服务器"><a href="#1-Spring-Boot不是应用服务器" class="headerlink" title="1. Spring Boot不是应用服务器"></a>1. Spring Boot不是应用服务器</h4><p>Spring Boot 可以把Ｗｅｂ应用程序变为可自执行的JAR文件，不用部署到传统web服务器中，就可以在命令行中执运行，这是因为Spring boot 内嵌了一个Servlet容器（Tomcat/Jetty或Undertow)，而不是Spring Boot实现的。</p>
<h4 id="2-类似的Spring-也没有实现JPA或JMS"><a href="#2-类似的Spring-也没有实现JPA或JMS" class="headerlink" title="2. 类似的Spring 也没有实现JPA或JMS"></a>2. 类似的Spring 也没有实现JPA或JMS</h4><h4 id="3-Spring-Boot本质上就是Spring"><a href="#3-Spring-Boot本质上就是Spring" class="headerlink" title="3. Spring Boot本质上就是Spring"></a>3. Spring Boot本质上就是Spring</h4><hr>
<p><a href="http://www.spring4all.com/article/266" target="_blank" rel="noopener">Spring Boot 自述</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://10000hours.top/2019/05/01/Mysql%EF%BC%889%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E2%80%94%E2%80%94%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Richey Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/01/Mysql%EF%BC%889%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E2%80%94%E2%80%94%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E7%B4%A2%E5%BC%95/" itemprop="url">Mysql（9）-数据库索引——给字符串加索引</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-01T00:00:00+08:00">
                2019-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/01/Mysql%EF%BC%889%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E2%80%94%E2%80%94%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E7%B4%A2%E5%BC%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/01/Mysql%EF%BC%889%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E2%80%94%E2%80%94%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E7%B4%A2%E5%BC%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/01/Mysql%EF%BC%889%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E2%80%94%E2%80%94%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E7%B4%A2%E5%BC%95/" class="leancloud_visitors" data-flag-title="Mysql（9）-数据库索引——给字符串加索引">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="索引长度限制"><a href="#索引长度限制" class="headerlink" title="索引长度限制"></a>索引长度限制</h1><p>默认情况下，InnoDB 引擎单一字段索引的长度最大为 767 字节</p>
<blockquote>
<p>If innodb_large_prefix is enabled (the default in 5.7.7 ), the index key prefix limit is 3072 bytes for InnoDB tables that use DYNAMIC or COMPRESSED row format. If innodb_large_prefix is disabled(the default in 5.7.6), the index key prefix limit is 767 bytes for tables of any row format.</p>
</blockquote>
<blockquote>
<p>MySQL assumes 3 bytes per utf8 character. 255 characters is the maximum index size you can specify per column, because 256x3=768, which breaks the 767 byte limit. If you don’t specify index size, MySQL chooses the maximum size (i.e. 255 per column)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE &#96;foo&#96; (  </span><br><span class="line">    -&gt;       &#96;a&#96; varchar(255) DEFAULT NULL,  </span><br><span class="line">    -&gt;       &#96;b&#96; varchar(255) DEFAULT NULL,  </span><br><span class="line">    -&gt;       &#96;c&#96; varchar(255) DEFAULT NULL,  </span><br><span class="line">    -&gt;       &#96;d&#96; varchar(255) DEFAULT NULL,  </span><br><span class="line">    -&gt;       &#96;e&#96; varchar(255) DEFAULT NULL,  </span><br><span class="line">    -&gt;        KEY &#96;a-b-c-d&#96; (&#96;a&#96;,&#96;b&#96;,&#96;c&#96;,&#96;d&#96;,&#96;e&#96;)  </span><br><span class="line">    -&gt; ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">ERROR 1071 (42000): Specified key was too long; max key length is 3072 bytes</span><br></pre></td></tr></table></figure>
<h1 id="为什么3072"><a href="#为什么3072" class="headerlink" title="为什么3072"></a>为什么3072</h1><p>我们知道InnoDB一个page的默认大小是16k。由于是Btree组织，要求叶子节点上一个page至少要包含两条记录（否则就退化链表了）。</p>
<p>所以一个记录最多不能超过8k。</p>
<p>又由于InnoDB的聚簇索引结构，一个二级索引要包含主键索引，因此每个单个索引不能超过4k （极端情况，pk和某个二级索引都达到这个限制）。</p>
<p>由于需要预留和辅助空间，扣掉后不能超过3500，取个“整数”就是(1024*3)。</p>
<h1 id="单列索引限制"><a href="#单列索引限制" class="headerlink" title="单列索引限制"></a>单列索引限制</h1><p>上面有提到单列索引限制767，起因是256×3-1。这个3是字符最大占用空间（utf8）。但是在5.5以后，开始支持4个字节的uutf8。255×4&gt;767, 于是增加了一个参数叫做 innodb_large_prefix。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;innodb_large_prefix&#39;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>innodb_large_prefix is enabled by default in MySQL 5.7. This change coincides with the default value change for innodb_file_format, which is set to Barracuda by default in MySQL 5.7. Together, these default value changes allow larger index key prefixes to be created when using DYNAMIC or COMPRESSED row format. If either option is set to a non-default value, index key prefixes larger than 767 bytes are silently truncated.</p>
</blockquote>
<p>innodb_large_prefix is deprecated and will be removed in a future release. innodb_large_prefix was introduced to disable large index key prefixes for compatibility with earlier versions of InnoDB that do not support large index key prefixes.</p>
<h1 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h1><p>使用了前缀索引，就用不上覆盖索引对查询性能的优化了。</p>
<p>前缀索引无法进行排序优化</p>
<h1 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h1><p>只支持等值查询，不支持范围查询；</p>
<p>无法进行排序优化；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/6/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Richey Liu" />
            
              <p class="site-author-name" itemprop="name">Richey Liu</p>
              <p class="site-description motion-element" itemprop="description">花有重开时人无再少年</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">105</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/liubaolin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="brin.baolin@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Richey Liu</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'espIarB7yj7vR1el85iiMLjb-gzGzoHsz',
        appKey: 'v35zFd1Yc4PX5KsGn2wHgrob',
        placeholder: '欢迎留言！',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("98BykxDu7C0UsRu0zaggGlMu-gzGzoHsz", "a21Q7nym42YYGdxdx2XxxQNM");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
